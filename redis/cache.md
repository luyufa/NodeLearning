## redis缓存

>缓解DB压力、提高QPS

在频繁使用且更新频率较低的资源合适做缓存，引入缓存会加剧系统复杂度，应尽可能把缓存与业务逻辑层分离


##### 缓存设计

* 粒度

缓存对象中究竟要放那些数据？一种数据一个对象，简单，读取写入速度都快，但是种类一多便不好管理；多种数据糅合到一个对象里，方便使用，但是会造成资源浪费。最好根据合适的业务场景拆分不同的缓存粒度。


* 结构

redis有五种可用的数据结构，`string` `list` `hash` `set` `zset`，根据不同的业务使用不同的数据结构


* 更新

  * 被动失效:一般在设置缓存时都设置上过期时间，到期自动删除
  * 主动失效:在更新数据时，更新或删除(懒加载,会出现空窗期)缓存

###### 套路
 1. 缓存命中->直接使用缓存数据
 2. 缓存被动失效->数据库查询->更新缓存
 3. 缓存主动失效->数据库更新->缓存删除。

缓存的删除应该放在数据库更新之后，如先删除缓存在更新数据库，试想同时并发get和put操作，此时put先删除缓存，get无法命中，查询数据库(依旧是老数据)，缓存更新，put操作在更新完数据库....就造成了一直都有脏数据;





